services:
  backend:
    build:
      context: .
      dockerfile: deploy/Dockerfile.backend
    container_name: crypto_backend
    env_file:
      - .env
    environment:
      APP_BASE_DIR: /app
      SQLITE_PATH: /app/data/trading.sqlite
      FORCE_SQLITE: "1"
    volumes:
      - ./.env:/app/.env
      - ./data:/app/data
      - ./trading.log:/app/trading.log
    ports:
      - "8000:8000"
    restart: unless-stopped

  scheduler:
    build:
      context: .
      dockerfile: deploy/Dockerfile.scheduler
    container_name: crypto_scheduler
    env_file:
      - .env
    environment:
      APP_BASE_DIR: /app
      SQLITE_PATH: /app/data/trading.sqlite
      FORCE_SQLITE: "1"
    volumes:
      - ./.env:/app/.env
      - ./data:/app/data
      - ./trading.log:/app/trading.log
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: deploy/Dockerfile.web
    container_name: crypto_frontend
    depends_on:
      - backend
    environment:
      NEXT_BUILD_DIR: /srv/app/web
    volumes:
      - ./web/out:/srv/app/web:ro
    ports:
      - "4173:4173"
    restart: unless-stopped
